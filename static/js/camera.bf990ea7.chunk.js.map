{"version":3,"sources":["components/icons.tsx","modules/client/actions.ts","pages/animations/fade-in.tsx","pages/animations/index.ts","pages/page-wrapper.tsx","components/camera-output/use-media-stream.ts","components/camera-output/use-take-picture-callback.ts","components/camera-output/styles.ts","components/camera-output/camera-output.tsx","pages/camera/styles.ts","pages/camera/layout.tsx"],"names":["Icon","type","icon","BackIcon","faChevronLeft","CantDisplayIcon","faEyeSlash","CameraIcon","faCamera","changeStage","createAsyncThunk","arg","thunkAPI","setTimeout","dispatch","clientSlice","actions","stage","ms","setSnapshot","snapshot","nextStage","fadeIn","keyframes","Animations","FadeIn","styled","div","props","duration","PageWrapper","children","style","width","height","createVideoStream","size","Promise","resolve","reject","getUserMedia","video","facingMode","stream","error","constraints","successCallback","errorCallback","navigator","webkitGetUserMedia","mozGetUserMedia","takePictureFromVideo","options","a","canvas","document","createElement","context","getContext","drawImage","canvasToBlob","toBlob","blob","Container","Error","PhotoButtons","LeftPhotoButton","PhotoButtonContainer","disabled","LoadPhotoInput","input","CameraOutput","takeSnapshotElement","loadPhotoElement","onLoadPhoto","videoRef","React","setStream","setError","then","catch","console","useMediaStream","current","srcObject","takePicture","handleClick","picture","ref","autoPlay","onLoad","onClick","LoadPhotoButton","handleChange","event","file","currentTarget","files","item","Blob","arrayBuffer","htmlFor","id","onChange","LoadButtonContainer","PhotoButton","Layout","useDispatch","handleLoadPhoto","photo","window","innerWidth","innerHeight"],"mappings":"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","file":"static/js/camera.bf990ea7.chunk.js","sourcesContent":["import { IconName } from \"@fortawesome/fontawesome-common-types\";\nimport { IconDefinition } from \"@fortawesome/fontawesome-svg-core\";\nimport {\n    faCamera,\n    faChevronLeft,\n    faEyeSlash,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport * as React from \"react\";\n\ntype IconProps = {\n    type: IconName | IconDefinition;\n};\n\nexport const Icon: React.FC<IconProps> = ({ type }) => {\n    return <FontAwesomeIcon icon={type} />;\n};\n\nexport const BackIcon = () => <Icon type={faChevronLeft} />;\n\nexport const CantDisplayIcon = () => <Icon type={faEyeSlash} />;\n\nexport const CameraIcon = () => <Icon type={faCamera} />;\n","import { createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { AppStage, clientSlice, Snapshot } from \"modules/client/slice\";\n\ntype ChangeStageArg = {\n    ms: number;\n    stage: AppStage;\n};\n\nexport const changeStage = createAsyncThunk<void, ChangeStageArg>(\n    \"client/change-stage\",\n    (arg, thunkAPI) => {\n        setTimeout(() => {\n            setTimeout(() => {\n                thunkAPI.dispatch(clientSlice.actions.changeStage(arg.stage));\n            }, arg.ms);\n        });\n    }\n);\n\ntype SetSnapshotArg = {\n    snapshot: Snapshot;\n    nextStage: AppStage;\n};\n\nexport const setSnapshot = createAsyncThunk<void, SetSnapshotArg>(\n    \"client/set-sbapshot\",\n    ({ snapshot, nextStage }, thunkAPI) => {\n        thunkAPI.dispatch(clientSlice.actions.setSnapshot(snapshot));\n        thunkAPI.dispatch(changeStage({ stage: nextStage, ms: 0 }));\n    }\n);\n","import styled, { keyframes } from \"styled-components\";\n\nconst fadeIn = keyframes`\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n`;\n\ntype FadeInProps = {\n    duration: number;\n};\n\nexport const FadeIn = styled.div<FadeInProps>`\n    animation: ${fadeIn} ${(props) => props.duration}s linear 1;\n`;\n","import { FadeIn } from \"pages/animations/fade-in\";\n\nexport const Animations = {\n    FadeIn,\n};\n","import { Animations } from \"pages/animations\";\nimport * as React from \"react\";\n\nexport const PageWrapper: React.FC = ({ children }) => {\n    return (\n        <Animations.FadeIn\n            duration={1}\n            style={{\n                width: \"100%\",\n                height: \"100%\",\n            }}\n        >\n            {children}\n        </Animations.FadeIn>\n    );\n};\n","import * as React from \"react\";\n\ntype UseMediaStreamProps = {\n    width: number;\n    height: number;\n};\n\nexport const useMediaStream = ({\n    height,\n    width,\n}: UseMediaStreamProps): [MediaStream | undefined, string | undefined] => {\n    const [stream, setStream] = React.useState<MediaStream>();\n    const [error, setError] = React.useState<string>();\n\n    React.useEffect(() => {\n        createVideoStream({ width, height })\n            .then((stream) => {\n                setStream(stream);\n            })\n            .catch((error) => {\n                console.error(error);\n\n                setError(\"Camera is not available\");\n            });\n    }, [setStream, setError, width, height]);\n\n    return [stream, error];\n};\n\ntype CreateVideoStreamProps = UseMediaStreamProps;\n\nconst createVideoStream = (size: CreateVideoStreamProps) => {\n    return new Promise<MediaStream>((resolve, reject) => {\n        getUserMedia(\n            {\n                video: {\n                    facingMode: \"environment\",\n                    width: size.height,\n                    height: size.width,\n                },\n            },\n            (stream) => resolve(stream),\n            (error) => reject(error)\n        );\n    });\n};\n\nconst getUserMedia = (\n    constraints: MediaStreamConstraints,\n    successCallback: NavigatorUserMediaSuccessCallback,\n    errorCallback: NavigatorUserMediaErrorCallback\n) => {\n    if (\"getUserMedia\" in navigator) {\n        return navigator.getUserMedia(\n            constraints,\n            successCallback,\n            errorCallback\n        );\n    }\n\n    if (\"webkitGetUserMedia\" in navigator) {\n        // @ts-ignore\n        return navigator.webkitGetUserMedia(\n            constraints,\n            successCallback,\n            errorCallback\n        );\n    }\n\n    if (\"mozGetUserMedia\" in navigator) {\n        // @ts-ignore\n        return navigator.mozGetUserMedia(\n            constraints,\n            successCallback,\n            errorCallback\n        );\n    }\n};\n","import * as React from \"react\";\n\ntype UseTakePictureCallbackProps = {\n    video: HTMLVideoElement | null;\n    width: number;\n    height: number;\n};\n\nexport const useTakePictureCallback = (\n    options: UseTakePictureCallbackProps\n) => {\n    return React.useCallback(() => {\n        return takePictureFromVideo(options);\n    }, [options]);\n};\n\ntype TakePictureFromVideoProps = UseTakePictureCallbackProps;\n\nconst takePictureFromVideo = async (options: TakePictureFromVideoProps) => {\n    if (options.video == null) {\n        return null;\n    }\n\n    const canvas = document.createElement(\"canvas\");\n    const context = canvas.getContext(\"2d\");\n\n    if (context == null) {\n        return null;\n    }\n\n    canvas.width = options.width;\n    canvas.height = options.height;\n\n    context.drawImage(options.video, 0, 0, options.width, options.height);\n\n    return await canvasToBlob(canvas);\n};\n\nconst canvasToBlob = (canvas: HTMLCanvasElement) => {\n    return new Promise<Blob | null>((resolve) => {\n        canvas.toBlob((blob) => resolve(blob));\n    });\n};\n","import styled from \"styled-components\";\n\ntype ContainerProps = {\n    width: number;\n    height: number;\n};\n\nexport const Container = styled.div<ContainerProps>`\n    position: relative;\n    width: ${({ width }) => width}px;\n    height: ${({ height }) => height}px;\n    background-color: black;\n`;\n\nexport const Error = styled.div`\n    color: white;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    pointer-events: none;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 50px;\n`;\n\nexport const PhotoButtons = styled.div`\n    width: 100%;\n    position: absolute;\n    bottom: 50px;\n    display: grid;\n\n    grid-template-areas: \"left center right\";\n`;\n\nexport const LeftPhotoButton = styled.div`\n    grid-area: left;\n\n    display: flex;\n    align-items: center;\n    justify-content: flex-end;\n`;\n\ntype PhotoButtonContainerProps = {\n    disabled?: boolean;\n};\n\nexport const PhotoButtonContainer = styled.div<PhotoButtonContainerProps>`\n    grid-area: center;\n\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    opacity: ${({ disabled }) => (disabled ? 0.5 : 1)};\n    pointer-events: ${({ disabled }) => (disabled ? \"none\" : \"auto\")};\n`;\n\nexport const LoadPhotoInput = styled.input`\n    display: none;\n`;\n","import { useMediaStream } from \"components/camera-output/use-media-stream\";\nimport { useTakePictureCallback } from \"components/camera-output/use-take-picture-callback\";\nimport { CantDisplayIcon } from \"components/icons\";\nimport * as React from \"react\";\nimport {\n    Container,\n    PhotoButtonContainer,\n    Error,\n    LoadPhotoInput,\n    PhotoButtons,\n    LeftPhotoButton,\n} from \"./styles\";\n\ntype CameraOutputProps = {\n    width: number;\n    height: number;\n    takeSnapshotElement: React.ReactElement;\n    loadPhotoElement: React.ReactElement;\n    onLoadPhoto: (snapshot: Blob) => void;\n};\n\nexport const CameraOutput: React.FC<CameraOutputProps> = ({\n    height,\n    width,\n    takeSnapshotElement,\n    loadPhotoElement,\n    onLoadPhoto,\n}) => {\n    const videoRef = React.useRef<HTMLVideoElement>(null);\n\n    const [stream, error] = useMediaStream({\n        height,\n        width,\n    });\n\n    React.useEffect(() => {\n        if (videoRef.current && stream) {\n            videoRef.current.srcObject = stream;\n        }\n    }, [stream]);\n\n    const takePicture = useTakePictureCallback({\n        video: videoRef.current,\n        width,\n        height,\n    });\n\n    const handleClick = React.useCallback(async () => {\n        const picture = await takePicture();\n\n        if (picture) {\n            onLoadPhoto(picture);\n        }\n    }, [takePicture, onLoadPhoto]);\n\n    return (\n        <Container width={width} height={height}>\n            <video ref={videoRef} autoPlay />\n\n            {error && (\n                <Error>\n                    <CantDisplayIcon />\n                </Error>\n            )}\n\n            <PhotoButtons>\n                <LoadPhotoButton onLoad={onLoadPhoto}>\n                    {loadPhotoElement}\n                </LoadPhotoButton>\n\n                <PhotoButtonContainer\n                    onClick={handleClick}\n                    disabled={!stream || !!error}\n                >\n                    {takeSnapshotElement}\n                </PhotoButtonContainer>\n            </PhotoButtons>\n        </Container>\n    );\n};\n\ntype LoadPhotoButtonProps = {\n    onLoad: (photo: Blob) => void;\n};\n\nconst LoadPhotoButton: React.FC<LoadPhotoButtonProps> = ({\n    children,\n    onLoad,\n}) => {\n    const handleChange = React.useCallback(\n        async (event: React.ChangeEvent<HTMLInputElement>) => {\n            const file = event.currentTarget.files?.item(0);\n\n            if (file) {\n                const blob = new Blob([await file.arrayBuffer()]);\n\n                onLoad(blob);\n            }\n        },\n        [onLoad]\n    );\n\n    return (\n        <LeftPhotoButton>\n            <label htmlFor={\"photo\"}>{children}</label>\n            <LoadPhotoInput\n                type={\"file\"}\n                id={\"photo\"}\n                onChange={handleChange}\n            />\n        </LeftPhotoButton>\n    );\n};\n","import styled from \"styled-components\";\n\nexport const Container = styled.div`\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n`;\n\nexport const PhotoButtonContainer = styled.div`\n    --size: 70px;\n\n    background-color: white;\n    width: var(--size);\n    height: var(--size);\n    border-radius: calc(var(--size) / 2);\n\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\n\n    &:active {\n        opacity: 0.8;\n    }\n`;\n\nexport const LoadButtonContainer = styled.div`\n    color: white;\n    font-size: 25px;\n`;\n","import { CameraOutput } from \"components/camera-output\";\nimport { CameraIcon } from \"components/icons\";\nimport { setSnapshot } from \"modules/client/actions\";\nimport {\n    Container,\n    PhotoButtonContainer,\n    LoadButtonContainer,\n} from \"pages/camera/styles\";\nimport { PageWrapper } from \"pages/page-wrapper\";\nimport * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nconst Layout: React.FC = () => {\n    const dispatch = useDispatch();\n\n    const handleLoadPhoto = React.useCallback(\n        (photo: Blob) => {\n            dispatch(\n                setSnapshot({\n                    snapshot: photo,\n                    nextStage: \"prediction\",\n                })\n            );\n        },\n        [dispatch]\n    );\n\n    return (\n        <PageWrapper>\n            <Container>\n                <CameraOutput\n                    width={window.innerWidth}\n                    height={window.innerHeight}\n                    takeSnapshotElement={<PhotoButton />}\n                    loadPhotoElement={<LoadPhotoButton />}\n                    onLoadPhoto={handleLoadPhoto}\n                />\n            </Container>\n        </PageWrapper>\n    );\n};\n\nconst PhotoButton: React.FC = () => {\n    return <PhotoButtonContainer />;\n};\n\nconst LoadPhotoButton: React.FC = () => {\n    return (\n        <LoadButtonContainer>\n            <CameraIcon />\n        </LoadButtonContainer>\n    );\n};\n\nexport default Layout;\n"],"sourceRoot":""}
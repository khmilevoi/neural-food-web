{"version":3,"sources":["components/icons.tsx","modules/client/actions.ts","pages/animations/fade-in.tsx","pages/animations/index.ts","pages/page-wrapper.tsx","modules/model/use-model.ts","modules/model/use-predictions.ts","modules/model/index.ts","shared/config.ts","shared/endpoints.ts","modules/loader/api.ts","modules/loader/actions.ts","pages/loading/styles.ts","pages/loading/loader.tsx","pages/loading/layout.tsx","components/swipe-container/use-touch.ts","components/swipe-container/styles.ts","components/swipe-container/swipe-container.tsx","pages/prediction/styles.ts","pages/prediction/layout.tsx"],"names":["Icon","type","icon","BackIcon","faChevronLeft","CantDisplayIcon","faEyeSlash","CameraIcon","faCamera","changeStage","createAsyncThunk","arg","thunkAPI","setTimeout","dispatch","clientSlice","actions","stage","ms","setSnapshot","snapshot","nextStage","fadeIn","keyframes","Animations","FadeIn","styled","div","props","duration","PageWrapper","children","style","width","height","L2","config","tf","l1l2","className","registerClass","useModel","modelDescriptor","React","useState","model","setModel","useEffect","load","a","then","currentModel","catch","error","console","usePredictions","labels","prediction","setPrediction","predictImage","result","map","accuracy","index","label","sort","left","right","predict","target","blobToImage","image","fromPixelsAsync","data","preparedData","expandDims","Array","isArray","promises","item","Promise","all","results","numbers","from","reduce","current","img","document","createElement","src","URL","createObjectURL","resolve","onload","endpoint","createPath","path","href","endpoints","loaderApi","onDownloadProgress","cancelToken","axios","get","response","loadData","entity","loaderSlice","changeStatus","progressEvent","progress","loaded","total","setProgress","Math","floor","setLabels","Container","CircleContainer","Circle","CircleTitle","span","Loader","action","title","useDispatch","loader","useLoader","value","text","titles","Layout","normalizeNumber","num","min","max","Header","ActiveElement","Content","header","SwipeContainer","containerHeight","containerRef","setStage","shift","setShift","handleTouchStart","handleTouchEnd","topDiff","abs","bottomDiff","handleTouchMove","event","touch","targetTouches","pageY","useTouch","createHandler","top","ref","onTouchStart","onTouchEnd","onTouchMove","BackButton","ImagePreview","Prediction","PredictionImage","PredictionInfo","PredictionTitle","PredictionAccuracy","PredictionLine","Predictions","list","toFixed","client","Client","predictions","Model","handleBack","onClick","window","innerHeight"],"mappings":"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","file":"static/js/loading.62c8ca98.chunk.js","sourcesContent":["import { IconName } from \"@fortawesome/fontawesome-common-types\";\nimport { IconDefinition } from \"@fortawesome/fontawesome-svg-core\";\nimport {\n    faCamera,\n    faChevronLeft,\n    faEyeSlash,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport * as React from \"react\";\n\ntype IconProps = {\n    type: IconName | IconDefinition;\n};\n\nexport const Icon: React.FC<IconProps> = ({ type }) => {\n    return <FontAwesomeIcon icon={type} />;\n};\n\nexport const BackIcon = () => <Icon type={faChevronLeft} />;\n\nexport const CantDisplayIcon = () => <Icon type={faEyeSlash} />;\n\nexport const CameraIcon = () => <Icon type={faCamera} />;\n","import { createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { AppStage, clientSlice, Snapshot } from \"modules/client/slice\";\n\ntype ChangeStageArg = {\n    ms: number;\n    stage: AppStage;\n};\n\nexport const changeStage = createAsyncThunk<void, ChangeStageArg>(\n    \"client/change-stage\",\n    (arg, thunkAPI) => {\n        setTimeout(() => {\n            setTimeout(() => {\n                thunkAPI.dispatch(clientSlice.actions.changeStage(arg.stage));\n            }, arg.ms);\n        });\n    }\n);\n\ntype SetSnapshotArg = {\n    snapshot: Snapshot;\n    nextStage: AppStage;\n};\n\nexport const setSnapshot = createAsyncThunk<void, SetSnapshotArg>(\n    \"client/set-sbapshot\",\n    ({ snapshot, nextStage }, thunkAPI) => {\n        thunkAPI.dispatch(clientSlice.actions.setSnapshot(snapshot));\n        thunkAPI.dispatch(changeStage({ stage: nextStage, ms: 0 }));\n    }\n);\n","import styled, { keyframes } from \"styled-components\";\n\nconst fadeIn = keyframes`\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n`;\n\ntype FadeInProps = {\n    duration: number;\n};\n\nexport const FadeIn = styled.div<FadeInProps>`\n    animation: ${fadeIn} ${(props) => props.duration}s linear 1;\n`;\n","import { FadeIn } from \"pages/animations/fade-in\";\n\nexport const Animations = {\n    FadeIn,\n};\n","import { Animations } from \"pages/animations\";\nimport * as React from \"react\";\n\nexport const PageWrapper: React.FC = ({ children }) => {\n    return (\n        <Animations.FadeIn\n            duration={1}\n            style={{\n                width: \"100%\",\n                height: \"100%\",\n            }}\n        >\n            {children}\n        </Animations.FadeIn>\n    );\n};\n","import * as tf from \"@tensorflow/tfjs\";\nimport { Entity } from \"modules/model/entity\";\nimport React from \"react\";\n\nclass L2 {\n    static className = \"L2\";\n\n    constructor(config: any) {\n        return tf.regularizers.l1l2(config);\n    }\n}\n\n// @ts-ignore\ntf.serialization.registerClass(L2);\n\nexport const useModel = (modelDescriptor?: Entity) => {\n    const [model, setModel] = React.useState<tf.LayersModel>();\n\n    React.useEffect(() => {\n        if (modelDescriptor) {\n            tf.loadLayersModel({\n                load: async () => modelDescriptor,\n            })\n                .then((currentModel) => {\n                    setModel(currentModel);\n                })\n                .catch((error) => {\n                    console.error(error);\n                });\n        }\n    }, [modelDescriptor]);\n\n    return model;\n};\n","import * as Client from \"modules/client\";\nimport * as Label from \"modules/label\";\nimport { Entity } from \"modules/model/entity\";\nimport { useModel } from \"modules/model/use-model\";\nimport * as tf from \"@tensorflow/tfjs\";\nimport * as React from \"react\";\n\nexport type Prediction = {\n    accuracy: number;\n    label: Label.Entity;\n};\n\nexport const usePredictions = (\n    modelDescriptor?: Entity,\n    snapshot?: Client.Snapshot,\n    labels?: Label.Entity[]\n) => {\n    const model = useModel(modelDescriptor);\n    const [prediction, setPrediction] = React.useState<Prediction[]>([]);\n\n    React.useEffect(() => {\n        const predict = async () => {\n            if (model == null || snapshot == null || labels == null) {\n                return [];\n            }\n\n            const prediction = await predictImage(snapshot, model);\n\n            const result = prediction.map<Prediction>((accuracy, index) => ({\n                accuracy,\n                label: labels[index],\n            }));\n\n            setPrediction(\n                result.sort((left, right) => {\n                    return right.accuracy - left.accuracy;\n                })\n            );\n        };\n\n        predict().catch();\n    }, [model, snapshot, setPrediction, labels]);\n\n    return prediction;\n};\n\nconst predictImage = async (\n    target: Blob,\n    model: tf.LayersModel\n): Promise<number[]> => {\n    const image = await blobToImage(target);\n\n    const data = await tf.browser.fromPixelsAsync(image);\n    const preparedData = data\n        // .resizeNearestNeighbor([299, 299])\n        // .toFloat()\n        .expandDims(0);\n\n    const predict = await model.predict(preparedData);\n\n    if (Array.isArray(predict)) {\n        const promises = predict.map((item) => item.data());\n\n        const results = await Promise.all(promises);\n        const numbers = results.map((result) => Array.from(result));\n\n        return numbers.reduce((result, current) => [...result, ...current]);\n    }\n\n    return Array.from(await predict.data());\n};\n\nconst blobToImage = (image: Blob) => {\n    const img = document.createElement(\"img\");\n\n    img.src = URL.createObjectURL(image);\n\n    return new Promise<HTMLImageElement>((resolve) => {\n        img.onload = () => {\n            resolve(img);\n        };\n    });\n};\n","export * from \"./entity\";\nexport * from \"./use-model\";\nexport * from \"./use-predictions\";\n","export const config = {\n    api: {\n        endpoint: \"https://drive.google.com/u/0/uc\",\n    },\n};\n\nexport const createPath = (path: string) => {\n    return new URL(path, config.api.endpoint).href;\n};\n","import {createPath} from \"shared/config\";\n\n\nexport const endpoints = {\n    model: createPath(\"?id=1FKgWsxK0JnNrfQ5xwd-4-LHExoe5VafC&export=download\"),\n    labels: createPath(\"?id=1Yq2CF0jVLJuRre-XlxrAk_-XTUmxOcgq&export=download\"),\n};\n","import axios, {CancelToken} from \"axios\";\nimport * as Label from \"modules/label\";\nimport * as Model from \"modules/model\";\nimport {endpoints} from \"shared\";\n\n\nexport const loaderApi = {\n    model: async (\n        onDownloadProgress: (progressEvent: ProgressEvent) => void,\n        cancelToken?: CancelToken\n    ) => {\n        const response = await axios.get<Model.Entity>(\n            endpoints.model,\n            {\n                cancelToken,\n                onDownloadProgress,\n            }\n        );\n        \n        return response.data;\n    },\n    labels: async (\n        onDownloadProgress: (progressEvent: any) => void,\n        cancelToken?: CancelToken\n    ) => {\n        const response = await axios.get<Label.Entity[]>(\n            endpoints.labels,\n            {\n                cancelToken,\n                onDownloadProgress,\n            }\n        );\n        \n        return response.data;\n    },\n};\n","import { createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { AppStage, clientSlice } from \"modules/client\";\nimport { changeStage } from \"modules/client/actions\";\nimport { loaderApi } from \"modules/loader/api\";\nimport { loaderSlice } from \"modules/loader/slice\";\n\ntype LoadDataArg = {\n    entity: \"model\" | \"labels\";\n    nextStage: AppStage;\n};\n\nexport const loadData = createAsyncThunk<void, LoadDataArg>(\n    \"loader/load-model\",\n    async ({ entity, nextStage }, thunkAPI) => {\n        thunkAPI.dispatch(loaderSlice.actions.changeStatus(\"progress\"));\n\n        const onDownloadProgress = (progressEvent: ProgressEvent) => {\n            const progress = (progressEvent.loaded * 100) / progressEvent.total;\n\n            setTimeout(() => {\n                thunkAPI.dispatch(\n                    loaderSlice.actions.setProgress(Math.floor(progress))\n                );\n            }, 300);\n        };\n\n        if (entity === \"model\") {\n            const model = await loaderApi.model(onDownloadProgress);\n\n            thunkAPI.dispatch(clientSlice.actions.setModel(model));\n        }\n\n        if (entity === \"labels\") {\n            const labels = await loaderApi.labels(onDownloadProgress);\n\n            thunkAPI.dispatch(clientSlice.actions.setLabels(labels));\n        }\n\n        thunkAPI.dispatch(loaderSlice.actions.changeStatus(\"default\"));\n        thunkAPI.dispatch(changeStage({ stage: nextStage, ms: 1000 }));\n    }\n);\n","import styled from \"styled-components\";\n\nexport const Container = styled.div`\n    width: 100%;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n`;\n\nexport const CircleContainer = styled.div``;\n\nexport const Circle = styled.div`\n    width: 100px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n`;\n\nexport const CircleTitle = styled.span`\n    margin-top: 10px;\n`;\n","import { useLoader } from \"modules/loader\";\nimport { Circle, CircleContainer, CircleTitle } from \"pages/loading/styles\";\nimport * as React from \"react\";\nimport { CircularProgressbar } from \"react-circular-progressbar\";\n\nimport \"react-circular-progressbar/dist/styles.css\";\n\nimport { useDispatch } from \"react-redux\";\n\ntype LoaderProps = {\n    title: string;\n    action: Function;\n};\n\nexport const Loader: React.FC<LoaderProps> = ({ action, title }) => {\n    const dispatch = useDispatch();\n\n    React.useEffect(() => {\n        dispatch(action());\n    }, [dispatch, action]);\n\n    const loader = useLoader();\n\n    return (\n        <CircleContainer>\n            <Circle>\n                <CircularProgressbar\n                    value={loader.progress}\n                    text={`${loader.progress}%`}\n                />\n                <CircleTitle>{title}</CircleTitle>\n            </Circle>\n        </CircleContainer>\n    );\n};\n","import { AppStage, PageProps } from \"modules/client\";\nimport { loaderSlice } from \"modules/loader\";\nimport { loadData } from \"modules/loader/actions\";\nimport { Loader } from \"pages/loading/loader\";\nimport { Container } from \"pages/loading/styles\";\nimport { PageWrapper } from \"pages/page-wrapper\";\nimport * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { PickString } from \"shared/types\";\n\nconst Layout: React.FC<PageProps<\"load-labels\" | \"load-model\">> = ({\n    stage,\n}) => {\n    const dispatch = useDispatch();\n\n    React.useEffect(() => {\n        dispatch(loaderSlice.actions.setProgress(0));\n    }, [dispatch, stage]);\n\n    return (\n        <PageWrapper>\n            <Container>\n                <Loader action={actions[stage]} title={titles[stage]} />\n            </Container>\n        </PageWrapper>\n    );\n};\n\nconst actions: {\n    [key in PickString<AppStage, \"load-labels\" | \"load-model\">]: Function;\n} = {\n    \"load-model\": () => loadData({ entity: \"model\", nextStage: \"load-labels\" }),\n    \"load-labels\": () => loadData({ entity: \"labels\", nextStage: \"camera\" }),\n};\n\nconst titles: {\n    [key in PickString<AppStage, \"load-labels\" | \"load-model\">]: string;\n} = {\n    \"load-model\": \"Load model\",\n    \"load-labels\": \"Load labels\",\n};\n\nexport default Layout;\n","import * as React from \"react\";\n\ntype TouchStage = \"start\" | \"move\" | \"default\";\ntype TouchAction = \"start\" | \"move\" | \"end\";\ntype CreateHandler = (action: TouchAction) => (event: React.TouchEvent) => void;\n\nexport const useTouch = (\n    min: number,\n    max: number\n): [CreateHandler, number, TouchStage] => {\n    const [stage, setStage] = React.useState<TouchStage>(\"default\");\n    const [shift, setShift] = React.useState(min);\n\n    const handleTouchStart = React.useCallback(() => {\n        setStage(\"start\");\n    }, [setStage]);\n\n    const handleTouchEnd = React.useCallback(() => {\n        const topDiff = Math.abs(max - shift);\n        const bottomDiff = Math.abs(min - shift);\n\n        if (topDiff < bottomDiff) {\n            setShift(max);\n        }\n\n        if (bottomDiff < topDiff) {\n            setShift(min);\n        }\n\n        setStage(\"default\");\n    }, [shift, setShift, setStage, max, min]);\n\n    const handleTouchMove = React.useCallback(\n        (event: React.TouchEvent) => {\n            setStage(\"move\");\n\n            const touch = event.targetTouches.item(0);\n\n            const shift = max - normalizeNumber(touch.pageY, 0, max - min);\n\n            setShift(shift);\n        },\n        [setStage, setShift, max, min]\n    );\n\n    const createHandler = React.useCallback<CreateHandler>(\n        (action) => {\n            switch (action) {\n                case \"move\":\n                    return handleTouchMove;\n                case \"end\":\n                    return handleTouchEnd;\n                case \"start\":\n                    return handleTouchStart;\n            }\n        },\n        [handleTouchStart, handleTouchMove, handleTouchEnd]\n    );\n\n    return [createHandler, shift, stage];\n};\n\nconst normalizeNumber = (num: number, min: number, max: number) => {\n    if (num < min) {\n        return min;\n    }\n\n    if (num > max) {\n        return max;\n    }\n\n    return num;\n};\n","import styled from \"styled-components\";\n\nexport const Container = styled.div`\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    transition: 0.1s;\n`;\n\ntype HeaderProps = {\n    height: number;\n};\n\nexport const Header = styled.div<HeaderProps>`\n    height: ${({ height }) => height}px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    border-radius: 99999px 99999px 0 0;\n    background-color: white;\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\n`;\n\nexport const ActiveElement = styled.div`\n    width: 50px;\n    height: 5px;\n    border-radius: 99999px;\n    background-color: silver;\n    cursor: pointer;\n`;\n\ntype ContentProps = {\n    header: number;\n};\n\nexport const Content = styled.div<ContentProps>`\n    background-color: white;\n    display: flex;\n    flex-direction: column;\n    height: calc(100% - ${({ header }) => header}px);\n    overflow-y: auto;\n    padding-top: 15px;\n`;\n","import { useTouch } from \"./use-touch\";\nimport * as React from \"react\";\nimport { ActiveElement, Container, Content, Header } from \"./styles\";\n\ntype SwipeContainerProps = {\n    containerHeight: number;\n};\n\nconst HEADER_SIZE = 55;\n\nexport const SwipeContainer: React.FC<SwipeContainerProps> = ({\n    containerHeight,\n    children,\n}) => {\n    const containerRef = React.useRef<HTMLDivElement>(null);\n\n    const [createHandler, shift] = useTouch(355, containerHeight);\n\n    React.useEffect(() => {\n        if (containerRef.current) {\n            containerRef.current.style.top = `calc(100% - ${shift}px)`;\n        }\n    }, [shift, containerRef]);\n\n    return (\n        <Container ref={containerRef}>\n            <Header\n                height={HEADER_SIZE}\n                onTouchStart={createHandler(\"start\")}\n                onTouchEnd={createHandler(\"end\")}\n                onTouchMove={createHandler(\"move\")}\n            >\n                <ActiveElement />\n            </Header>\n            <Content header={HEADER_SIZE}>{children}</Content>\n        </Container>\n    );\n};\n","import styled from \"styled-components\";\n\nexport const Container = styled.div`\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    position: relative;\n`;\n\nexport const BackButton = styled.div`\n    position: absolute;\n    top: 20px;\n    left: 15px;\n    color: white;\n    z-index: 1000;\n    font-size: 30px;\n`;\n\nexport const ImagePreview = styled.img`\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n`;\n\nexport const Prediction = styled.div`\n    display: flex;\n    position: relative;\n`;\n\nexport const PredictionImage = styled.img`\n    width: 40%;\n    height: 100px;\n    object-fit: cover;\n`;\n\nexport const PredictionInfo = styled.div`\n    padding: 0 15px;\n`;\n\nexport const PredictionTitle = styled.div`\n    font-size: 20px;\n`;\n\nexport const PredictionAccuracy = styled.div`\n    color: silver;\n`;\n\nexport const PredictionLine = styled.div``;\n","import { BackIcon } from \"components/icons\";\nimport { SwipeContainer } from \"components/swipe-container\";\nimport * as Client from \"modules/client\";\nimport { changeStage } from \"modules/client/actions\";\nimport * as Model from \"modules/model\";\nimport { PageWrapper } from \"pages/page-wrapper\";\nimport * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport {\n    BackButton,\n    Container,\n    ImagePreview,\n    Prediction,\n    PredictionAccuracy,\n    PredictionImage,\n    PredictionInfo,\n    PredictionLine,\n    PredictionTitle,\n} from \"./styles\";\n\nconst Layout: React.FC = () => {\n    const client = Client.useClient();\n\n    const predictions = Model.usePredictions(\n        client.model,\n        client.snapshot,\n        client.labels\n    );\n\n    const dispatch = useDispatch();\n\n    const handleBack = React.useCallback(() => {\n        dispatch(changeStage({ stage: \"camera\", ms: 0 }));\n    }, [dispatch]);\n\n    if (client.snapshot == null || client.model == null) {\n        return null;\n    }\n\n    return (\n        <PageWrapper>\n            <Container>\n                <BackButton onClick={handleBack}>\n                    <BackIcon />\n                </BackButton>\n\n                <ImagePreview src={URL.createObjectURL(client.snapshot)} />\n\n                <SwipeContainer containerHeight={window.innerHeight}>\n                    <Predictions list={predictions} />\n                </SwipeContainer>\n            </Container>\n        </PageWrapper>\n    );\n};\n\ntype PredictionsProps = {\n    list: Model.Prediction[];\n};\n\nconst Predictions: React.FC<PredictionsProps> = ({ list }) => {\n    return (\n        <>\n            {list.map((item) => (\n                <Prediction key={item.label.title}>\n                    <PredictionImage src={item.label.image} />\n\n                    <PredictionInfo>\n                        <PredictionLine>\n                            <PredictionTitle>\n                                {item.label.title}\n                            </PredictionTitle>\n                        </PredictionLine>\n\n                        <PredictionLine>\n                            <PredictionAccuracy>\n                                Accuracy: {(item.accuracy * 100).toFixed(3)}%\n                            </PredictionAccuracy>\n                        </PredictionLine>\n                    </PredictionInfo>\n                </Prediction>\n            ))}\n        </>\n    );\n};\n\nexport default Layout;\n"],"sourceRoot":""}